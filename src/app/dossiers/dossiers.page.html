<ion-header>
  <ion-toolbar color="dark">
    <ion-buttons slot="end">
      <!-- <ion-menu-button></ion-menu-button> -->
    </ion-buttons>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>

    <app-notification [notif]='totalNotif' slot="end"></app-notification>
  </ion-toolbar>

  <ion-toolbar class=" ion-margin-top">
    <!-- +++ SEGMENT +++ -->
    <ion-segment class="ion-padding-top ion-padding-top" mode='md'>
      <ion-segment-button (ionSelect)="segmentButtonClicked('dEnvoyes')" checked="true" value=''>
        <span class="icon-dos-sent _text-dark  text15 "></span>
        <ion-label class="ion-text-wrap">Dossiers envoyés</ion-label>
        <!-- <ion-icon name=""><span class="icon-doctor-sos-21 text18"></span></ion-icon> -->
      </ion-segment-button>
      <ion-segment-button (ionSelect)="segmentButtonClicked('dEnCours')">
        <span class="icon-dos-pended _text-dark  text15 "></span>
        <ion-label class="ion-text-wrap">Demandes d'avis</ion-label>
        <!-- <ion-icon name=""><span class="icon-doctor-sos-21 text18"></span></ion-icon> -->
      </ion-segment-button>
    </ion-segment>

    <!-- TOGGLE -->
    <ion-item lines="none">
      <small class="cr-name"><b>{{ dossiersEnCours ? totalPending : totalSending }} </b>DOSSIERS EN COURS</small>
      <ng-container *ngIf='dossiersEnCours'>
        <ion-note slot="end" class="ion-no-margin toggle-note ion-text-nowrap">
          <small class="cr-name">NON LUS</small>
          <ion-toggle mode="md" (click)="isFilttred(isToggleFiltter)" [(ngModel)]="isToggleFiltter"></ion-toggle>
        </ion-note>
      </ng-container>
    </ion-item>

    <!-- +++ SEGMENT +++ -->
  </ion-toolbar>
</ion-header>

<!-- BLOC :::::::: TITLE HEADER   :::::::: -->
<ion-grid fixed class="ion-no-padding  header-card-fix box-shadow">
  <ion-row class="ion-no-padding ">
    <ion-col size="12" class="icon-header">
      <span class="icon-cr text-white text22"></span>
    </ion-col>
    <ion-col size="12" class="title-header ">{{nameEtab}} </ion-col>
  </ion-row>
</ion-grid>


<!-- CONTENT BLOC :::::::: SENDING  dossier :::::::: -->

<ion-content class="cudt-info ion-no-padding">

  <ng-container *ngIf="dossiersEnvoyes">
    <!-- REFRESH-->
    <ion-refresher slot="fixed" (ionRefresh)="doRefreshSending($event)">
      <ion-refresher-content pullingIcon="arrow-dropdown" pullingText="Tirer pour rafraîchir"
        refreshingSpinner="bubbles" refreshingText="Rafraîchir la liste...">
      </ion-refresher-content>
    </ion-refresher>





    <ion-grid class="ion-no-padding">
      <ion-row>
        <ion-col size="12" class="ion-no-padding">


          <!-- INFO EMPTY DOSSIER-->
          <ion-card *ngIf='totalSending === 0'>
            <ion-card-content class="text09 ion-no-padding ">
              <ion-list lines="none" class="info-empty-dossier">

                <ion-item>
                  <ion-chip color="primary">
                    <ion-icon name="information-circle-outline"></ion-icon>
                    <ion-label class="ion-text-wrap">
                      <ion-text>
                        <h2>Pour l'instant, vous n'avez reçu aucun dossier.</h2>
                      </ion-text>
                    </ion-label>
                  </ion-chip>
                </ion-item>

                <ion-item>
                  <ion-avatar slot="start">
                    <img src="assets/images/hand-pull.png" alt="pull down">
                  </ion-avatar>
                  <ion-label class="ion-text-wrap">
                    <ion-text color="secondary">
                      <p class="error-message"> Veuillez rafraîchir pour actualiser les données</p>
                    </ion-text>
                  </ion-label>
                </ion-item>

              </ion-list>
            </ion-card-content>
          </ion-card>

          <!-- DISPLAY DOSSIER-->
          <ion-card *ngIf='totalSending > 0'>
            <ion-card-content class="text09 ion-no-padding ">
              <ion-list class="ion-no-padding ">
                <ion-item detail lines="full" *ngFor="let item of dataDossiersSending" tappable class='penddig-list'
                  (click)="getDossier(item?.dossierId)">

                  <ion-avatar slot="start">
                    <ion-icon name="checkmark-circle"></ion-icon>
                    <span class="icon-doss-patient text-dark  text15"> </span>
                  </ion-avatar>

                  <ion-label class="ion-text-wrap">
                    <h3> {{item?.lastName}} {{item?.firstName}}</h3>
                    <!-- <small>DOSSIER N°: <b>{{getRandomNumber()}}</b> </small> -->
                    <small>AGE : {{item?.age}} Ans | {{item?.gender === '2'  ? 'Homme' : 'Femme'}}</small>
                    <small>CUDT : <b>{{item?.etabName}}</b> </small>
                  </ion-label>

                </ion-item>
              </ion-list>
            </ion-card-content>
          </ion-card>

        </ion-col>
      </ion-row>
    </ion-grid>

  </ng-container>

  <!-- CONTENT BLOC :::::::: PENDING dossier ::::::::-->
  <ng-container *ngIf="dossiersEnCours">

    <!-- REFRESH-->
    <ion-refresher slot="fixed" (ionRefresh)="doRefreshPending($event)">
      <ion-refresher-content pullingIcon="arrow-dropdown" pullingText="Tirer pour rafraîchir"
        refreshingSpinner="bubbles" refreshingText="Rafraîchir la liste...">
      </ion-refresher-content>
    </ion-refresher>




    <ion-grid class="ion-no-padding">
      <ion-row>
        <ion-col size="12" class="ion-no-padding">

          <!-- INFO EMPTY DOSSIER-->
          <ion-card *ngIf='totalPending === 0'>
            <ion-card-content class="text09 ion-no-padding ">
              <ion-list lines="none" class="info-empty-dossier">

                <ion-item>
                  <ion-chip color="primary">
                    <ion-icon name="information-circle-outline"></ion-icon>
                    <ion-label class="ion-text-wrap">
                      <ion-text>
                        <h2>Pour l'instant, vous n'avez reçu aucune notification.</h2>
                      </ion-text>
                    </ion-label>
                  </ion-chip>
                </ion-item>

                <ion-item>
                  <ion-avatar slot="start">
                    <img src="assets/images/hand-pull.png" alt="pull down">
                  </ion-avatar>
                  <ion-label class="ion-text-wrap">
                    <ion-text color="secondary">
                      <p class="error-message"> Veuillez rafraîchir pour actualiser les données</p>
                    </ion-text>
                  </ion-label>
                </ion-item>

              </ion-list>
            </ion-card-content>
          </ion-card>
          <!-- DISPLAY DOSSIER-->
          <ion-card *ngIf='totalPending > 0'>
            <ion-card-content class="text09 ion-no-padding ">

              <ion-list class="ion-no-padding">
                <ion-item lines="full" *ngFor="let item of listOfWaittingNotif" tappable>

                  <ion-avatar slot="start"> <span class="icon-doss-patient text-dark  text15"></span></ion-avatar>
                  <ion-label class="ion-text-wrap">
                    <h3> {{item?.lastName}} {{item?.firstName}}</h3>
                    <!-- <small>DOSSIER N°: <b>{{getRandomNumber()}}</b> </small> -->
                    <small>AGE : {{item?.age}} Ans | {{item?.gender === '2'  ? 'Homme' : 'Femme'}}</small>
                    <small>CUDT : <b>{{item?.etabName}}</b> </small>
                    <div>

                      <div *ngFor=" let item of item['prevNotif']; let i = index; let l = count">
                        <!-- i : {{ i }} - count :{{ l }} -->

                        <div *ngIf="item?.motifId !== null ">
                          <div *ngIf="item?.motifId === 1 ">
                            <ion-icon name="checkmark-circle" [style.color]="'#f25454'"></ion-icon>
                          </div>
                          <div *ngIf="item?.motifId === 2 ">
                            <ion-icon name="checkmark-circle" [style.color]="'#02a1b3'"></ion-icon>
                          </div>
                          <div *ngIf="item?.motifId === 3 ">
                            <ion-icon name="checkmark-circle" [style.color]="'#516bf0'"></ion-icon>
                          </div>
                        </div>

                        <div *ngIf="item?.motifId === null ">
                          <ion-icon name="checkmark-circle" [style.color]="'#bfced0'"></ion-icon>
                        </div>

                      </div>

                    </div>
                  </ion-label>
                  <!-- <p>{{item['motifId'].length}}</p> -->
                  <!-- Boutton Avis doctor  -->
                  <ion-button Fill='clear' shape='round' class="icon-avis" tappable
                    (click)="actionSheetSetDoctorReview(item?.lastDemandeId ,  item?.lastMotifId )" type="button"
                    disabled="{{item?.lastMotifId === 0 ? true : false }}">
                    <span class="icon-doctor-sos-2 status-avis" [ngClass]="{ 
                    'notif-none':item?.lastMotifId === 0,
                    'notif-sos':item?.lastMotifId=== 1,
                    'notif-thrombolyse':item?.lastMotifId === 2,
                    'notif-sendding':item?.lastMotifId === 3 }" tappable></span>
                  </ion-button>



                  <ion-button Fill='solid' shape='round' tappable class="icon-detail"
                    (click)="getDossier(item?.dossierId)" type="button">
                    <ion-icon slot="icon-only" name="arrow-forward" mode='ios'></ion-icon>
                  </ion-button>

                  <!-- Boutton détails dossier   -->
                  <!-- <ion-icon name="arrow-forward" class=" arrow" mode='ios' slot="end"
                    (click)="getDossier(item?.dossierId)"></ion-icon> -->

                </ion-item>
              </ion-list>

            </ion-card-content>
          </ion-card>

        </ion-col>
      </ion-row>
    </ion-grid>

  </ng-container>

</ion-content>